{% extends 'pizzeria/base.html' %} {% load static %} {% block title %}Личный
кабинет - Pizzahunt{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %} {% block content %}
<section class="profile-section">
  <div class="container">
    <div class="profile-header">
      <h1 class="page-title">Личный кабинет</h1>
      <div class="profile-welcome">
        <p>Добро пожаловать, <strong>{{ user.username }}</strong>!</p>
      </div>
    </div>

    <div class="profile-content">
      <!-- Боковая панель -->
      <div class="profile-sidebar">
        <div class="user-card">
          <div class="user-avatar">
            {% if user.profile.avatar %}
            <img
              src="{{ user.profile.avatar.url }}"
              alt="{{ user.username }}"
            />
            {% else %}
            <div class="avatar-placeholder">
              <i class="fas fa-user"></i>
            </div>
            {% endif %}
          </div>
          <h3 class="user-name">
            {{ user.get_full_name|default:user.username }}
          </h3>
          <p class="user-email">{{ user.email }}</p>
          <p class="user-phone">
            {{ user.profile.phone|default:"Телефон не указан" }}
          </p>
          <p class="user-since">С нами с {{ user.date_joined|date:"d.m.Y" }}</p>
        </div>

        <nav class="profile-nav">
          <a href="{% url 'profile' %}" class="nav-item active">
            <i class="fas fa-home"></i> Обзор
          </a>
          <a href="{% url 'profile_edit' %}" class="nav-item">
            <i class="fas fa-user-edit"></i> Редактировать профиль
          </a>
          <a href="{% url 'logout' %}" class="nav-item">
            <i class="fas fa-sign-out-alt"></i> Выйти
          </a>
        </nav>

        <!-- Админ секция -->
        {% if user.is_staff %} 
        <div class="admin-section">
          <h4><i class="fas fa-crown"></i> Администратор</h4>
          <a
            href="{% url 'admin_dashboard' %}"
            class="nav-item"
            style="background: #d32f2f; color: white"
          >
            <i class="fas fa-tachometer-alt"></i> Панель управления
          </a>
          <a href="/admin/" class="nav-item" target="_blank">
            <i class="fas fa-cog"></i> Админ-панель Django
          </a>
        </div>
        {% endif %}
      </div>

      <!-- Основной контент -->
      <div class="profile-main">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">{{ orders|length }}</h3>
              <p class="stat-label">Заказов всего</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-ruble-sign"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">
                {% if total_spent %} {{ total_spent|floatformat:0 }} {% else %}
                0 {% endif %}
              </h3>
              <p class="stat-label">Потрачено всего</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-star"></i>
            </div>
            <div class="stat-info">
              <h3 class="stat-value">0</h3>
              <p class="stat-label">Бонусных баллов</p>
            </div>
          </div>
        </div>

        <!-- Последние заказы -->
        <div class="recent-orders">
          <h2 class="section-title">Последние заказы</h2>

          {% if orders %}
          <div class="orders-list">
            {% for order in orders %}
            <div class="order-item">
              <div class="order-header">
                <div class="order-id">Заказ #{{ order.id }}</div>
                <div class="order-date">
                  {{ order.created_at|date:"d.m.Y H:i" }}
                </div>
                <div class="order-status {{ order.status }}">
                  {{ order.get_status_display }}
                </div>
              </div>
              <div class="order-body">
                <div class="order-info">
                  <p><strong>Сумма:</strong> {{ order.total_price }} ₽</p>
                  <p>
                    <strong>Доставка:</strong> {{ order.address|truncatechars:50}}
                  </p>
                  <p>
                    <strong>Оплата:</strong>
                    {% if order.payment_status %}
                    <span class="text-success">Оплачен</span>
                    {% else %}
                    <span class="text-warning">Не оплачен</span>
                    {% endif %}
                  </p>
                  <p>
                    <strong>Способ оплаты:</strong> {{order.get_payment_method_display }}
                  </p>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          {% else %}
          <div class="empty-state">
            <i class="fas fa-shopping-cart"></i>
            <h3>У вас еще нет заказов</h3>
            <p>Сделайте свой первый заказ и он появится здесь</p>
            <a
              href="{% url 'menu' %}"
              class="btn btn-primary"
              style="margin-top: 20px"
            >
              <i class="fas fa-pizza-slice"></i> Перейти в меню
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const statCards = document.querySelectorAll(".stat-card");
    statCards.forEach((card, index) => {
      card.style.animationDelay = `${index * 0.1}s`;
    });

    const navItems = document.querySelectorAll(".nav-item");
    navItems.forEach((item) => {
      item.addEventListener("click", function () {
        navItems.forEach((i) => i.classList.remove("active"));
        this.classList.add("active");
      });
    });
  });
</script>
{% endblock %}
